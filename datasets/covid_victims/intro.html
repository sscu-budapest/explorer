
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Explore Waves and Conditions &#8212; Data Catalog</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/admonitions.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tables.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/buttons.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Scimago Journals" href="../../dataset-pages/scimago_journals.html" />
    <link rel="prev" title="Covid Victims" href="../../dataset-pages/covid_victims.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Data Catalog</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../dataset-pages/covid_victims.html">
   Covid Victims
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Explore Waves and Conditions
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../dataset-pages/scimago_journals.html">
   Scimago Journals
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../scimago_journals/intro.html">
     Check Basics
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../dataset-pages/pypi_downloads.html">
   Pypi Downloads
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../pypi_downloads/intro.html">
     Usage Analysis
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../dataset-pages/repec_via_nep.html">
   RePEc via NEP
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../repec_via_nep/intro.html">
     Check Head
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../dataset-pages/hungarian_elections.html">
   Hungarian Elections
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../hungarian_elections/intro.html">
     WIP: Create some more analysis here
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/datasets/covid_victims/intro.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/datasets/covid_victims/intro.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Explore Waves and Conditions</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="explore-waves-and-conditions">
<h1>Explore Waves and Conditions<a class="headerlink" href="#explore-waves-and-conditions" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;covid_victim.csv&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">is_70_plus</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">70</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>serial</th>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>5</td>
    </tr>
    <tr>
      <th>age</th>
      <td>76</td>
      <td>65</td>
      <td>74</td>
      <td>79</td>
      <td>68</td>
    </tr>
    <tr>
      <th>condition__blood_pressure</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>condition__diabetes</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>condition__heart</th>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>condition__lungs</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>condition__obesity</th>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
      <td>False</td>
    </tr>
    <tr>
      <th>estimated_date</th>
      <td>2020-03-20</td>
      <td>2020-03-20</td>
      <td>2020-03-20</td>
      <td>2020-03-22</td>
      <td>2020-03-22</td>
    </tr>
    <tr>
      <th>is_male</th>
      <td>False</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>True</td>
    </tr>
    <tr>
      <th>people_fully_vaccinated</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>people_vaccinated</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>positive_rate</th>
      <td>0.0307</td>
      <td>0.0307</td>
      <td>0.0307</td>
      <td>0.0309</td>
      <td>0.0309</td>
    </tr>
    <tr>
      <th>raw_conditions</th>
      <td>szív és érrendszeri</td>
      <td>rosszindulatú daganat</td>
      <td>szív és érrendszeri</td>
      <td>szív és érrendszeri</td>
      <td>szív és érrendszeri</td>
    </tr>
    <tr>
      <th>total_boosters</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>total_vaccinations</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>is_70_plus</th>
      <td>True</td>
      <td>False</td>
      <td>True</td>
      <td>True</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cond_cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;condition&quot;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_cols</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;positive_rate&quot;</span><span class="p">,</span>
    <span class="s2">&quot;total_vaccinations&quot;</span><span class="p">,</span>
    <span class="s2">&quot;people_vaccinated&quot;</span><span class="p">,</span>
    <span class="s2">&quot;people_fully_vaccinated&quot;</span><span class="p">,</span>
    <span class="s2">&quot;total_boosters&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">sum_cols</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="n">cond_cols</span><span class="p">,</span> <span class="s2">&quot;is_70_plus&quot;</span><span class="p">,</span> <span class="s2">&quot;is_male&quot;</span><span class="p">]</span>
<span class="n">aggs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">**</span><span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">sum_cols</span><span class="p">},</span>
    <span class="o">**</span><span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">mean_cols</span><span class="p">},</span>
    <span class="s2">&quot;count&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">MIN_ASC</span> <span class="o">=</span> <span class="mi">30</span>


<span class="k">def</span> <span class="nf">get_wave_n</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">wave_ascents</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;stage&quot;</span><span class="p">)[</span><span class="s2">&quot;climb&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">&gt;</span> <span class="mi">40</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
    <span class="n">_dic</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wave_ascents</span><span class="p">)}</span>
    <span class="n">wave_dic</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">_dic</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">_dic</span><span class="o">.</span><span class="n">items</span><span class="p">()}}</span>
    <span class="n">subseq_waves</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">wave_dic</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;stage&quot;</span><span class="p">]],</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;climb&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">MIN_ASC</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="n">subseq_waves</span><span class="p">,</span> <span class="mi">0</span>
    <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>


<span class="n">weekly_wave_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pdate</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;estimated_date&quot;</span><span class="p">]))</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;pdate&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">aggs</span><span class="p">)</span>
    <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;1W&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">aggs</span><span class="p">)</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">climb</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">(),</span>
        <span class="n">stage</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;climb&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">MIN_ASC</span><span class="p">)</span>
        <span class="o">.</span><span class="n">diff</span><span class="p">()</span>
        <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s</span> <span class="o">!=</span> <span class="n">s</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">s</span> <span class="o">!=</span> <span class="n">s</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
        <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="o">.</span><span class="n">cumsum</span><span class="p">(),</span>
        <span class="n">wave</span><span class="o">=</span><span class="n">get_wave_n</span><span class="p">,</span>
        <span class="n">wave_stage</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;stage&quot;</span><span class="p">)[</span><span class="s2">&quot;climb&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;ascent&quot;</span><span class="p">,</span> <span class="s2">&quot;descent&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;wave&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;0&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">weekly_wave_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;pdate&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;wave&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;wave_stage&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/intro_7_0.png" src="../../_images/intro_7_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">changes</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">weekly_wave_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">sum_cols</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">df</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">shift</span><span class="p">()))</span>
    <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span> <span class="o">-</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;count&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;count&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">changes</span><span class="p">,</span> <span class="n">weekly_wave_df</span><span class="p">[[</span><span class="s2">&quot;wave&quot;</span><span class="p">,</span> <span class="s2">&quot;wave_stage&quot;</span><span class="p">]]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;wave&quot;</span><span class="p">,</span> <span class="s2">&quot;wave_stage&quot;</span><span class="p">],</span> <span class="n">values</span><span class="o">=</span><span class="n">sum_cols</span><span class="p">)</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;condition__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">background_gradient</span><span class="p">(</span>
        <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">vmin</span><span class="o">=-</span><span class="mf">0.1</span><span class="p">,</span>
        <span class="n">vmax</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">sns</span><span class="o">.</span><span class="n">diverging_palette</span><span class="p">(</span>
            <span class="mi">220</span><span class="p">,</span>
            <span class="mi">20</span><span class="p">,</span>
            <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_6adad_row0_col0 {
  background-color: #ebeff0;
  color: #000000;
}
#T_6adad_row0_col1, #T_6adad_row0_col5 {
  background-color: #f1ebe9;
  color: #000000;
}
#T_6adad_row0_col2 {
  background-color: #e0b6ac;
  color: #000000;
}
#T_6adad_row0_col3, #T_6adad_row1_col1, #T_6adad_row2_col0 {
  background-color: #f2f0ef;
  color: #000000;
}
#T_6adad_row0_col4, #T_6adad_row4_col0 {
  background-color: #e3e9ec;
  color: #000000;
}
#T_6adad_row0_col6 {
  background-color: #e0e8ea;
  color: #000000;
}
#T_6adad_row1_col0 {
  background-color: #efe7e5;
  color: #000000;
}
#T_6adad_row1_col2 {
  background-color: #e9d2cd;
  color: #000000;
}
#T_6adad_row1_col3, #T_6adad_row5_col5 {
  background-color: #ead5d0;
  color: #000000;
}
#T_6adad_row1_col4 {
  background-color: #dfb3a7;
  color: #000000;
}
#T_6adad_row1_col5 {
  background-color: #f0f2f2;
  color: #000000;
}
#T_6adad_row1_col6, #T_6adad_row3_col5 {
  background-color: #e8edef;
  color: #000000;
}
#T_6adad_row2_col1 {
  background-color: #f1edec;
  color: #000000;
}
#T_6adad_row2_col2 {
  background-color: #98b9c3;
  color: #000000;
}
#T_6adad_row2_col3 {
  background-color: #8eb2be;
  color: #000000;
}
#T_6adad_row2_col4 {
  background-color: #c3553a;
  color: #f1f1f1;
}
#T_6adad_row2_col5, #T_6adad_row3_col2 {
  background-color: #cad9de;
  color: #000000;
}
#T_6adad_row2_col6 {
  background-color: #ede0dd;
  color: #000000;
}
#T_6adad_row3_col0 {
  background-color: #dce5e8;
  color: #000000;
}
#T_6adad_row3_col1 {
  background-color: #e7ccc6;
  color: #000000;
}
#T_6adad_row3_col3 {
  background-color: #d99f90;
  color: #000000;
}
#T_6adad_row3_col4 {
  background-color: #b7cdd4;
  color: #000000;
}
#T_6adad_row3_col6 {
  background-color: #eee2df;
  color: #000000;
}
#T_6adad_row4_col1 {
  background-color: #93b6c1;
  color: #000000;
}
#T_6adad_row4_col2 {
  background-color: #e7cbc4;
  color: #000000;
}
#T_6adad_row4_col3 {
  background-color: #dfe7ea;
  color: #000000;
}
#T_6adad_row4_col4 {
  background-color: #aac5cd;
  color: #000000;
}
#T_6adad_row4_col5 {
  background-color: #ecddda;
  color: #000000;
}
#T_6adad_row4_col6 {
  background-color: #d2dfe3;
  color: #000000;
}
#T_6adad_row5_col0 {
  background-color: #efe6e4;
  color: #000000;
}
#T_6adad_row5_col1 {
  background-color: #f2eeee;
  color: #000000;
}
#T_6adad_row5_col2 {
  background-color: #e6cac3;
  color: #000000;
}
#T_6adad_row5_col3 {
  background-color: #ecf0f1;
  color: #000000;
}
#T_6adad_row5_col4 {
  background-color: #9abac4;
  color: #000000;
}
#T_6adad_row5_col6 {
  background-color: #e7ecee;
  color: #000000;
}
</style>
<table id="T_6adad_">
  <thead>
    <tr>
      <th class="blank" >&nbsp;</th>
      <th class="blank level0" >&nbsp;</th>
      <th class="col_heading level0 col0" >blood_pressure</th>
      <th class="col_heading level0 col1" >diabetes</th>
      <th class="col_heading level0 col2" >heart</th>
      <th class="col_heading level0 col3" >lungs</th>
      <th class="col_heading level0 col4" >obesity</th>
      <th class="col_heading level0 col5" >is_70_plus</th>
      <th class="col_heading level0 col6" >is_male</th>
    </tr>
    <tr>
      <th class="index_name level0" >wave</th>
      <th class="index_name level1" >wave_stage</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
      <th class="blank col5" >&nbsp;</th>
      <th class="blank col6" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_6adad_level0_row0" class="row_heading level0 row0" rowspan="2">1</th>
      <th id="T_6adad_level1_row0" class="row_heading level1 row0" >ascent</th>
      <td id="T_6adad_row0_col0" class="data row0 col0" >-0.002742</td>
      <td id="T_6adad_row0_col1" class="data row0 col1" >0.004524</td>
      <td id="T_6adad_row0_col2" class="data row0 col2" >0.037642</td>
      <td id="T_6adad_row0_col3" class="data row0 col3" >0.000924</td>
      <td id="T_6adad_row0_col4" class="data row0 col4" >-0.007773</td>
      <td id="T_6adad_row0_col5" class="data row0 col5" >0.004463</td>
      <td id="T_6adad_row0_col6" class="data row0 col6" >-0.008982</td>
    </tr>
    <tr>
      <th id="T_6adad_level1_row1" class="row_heading level1 row1" >descent</th>
      <td id="T_6adad_row1_col0" class="data row1 col0" >0.006391</td>
      <td id="T_6adad_row1_col1" class="data row1 col1" >0.000929</td>
      <td id="T_6adad_row1_col2" class="data row1 col2" >0.019753</td>
      <td id="T_6adad_row1_col3" class="data row1 col3" >0.017998</td>
      <td id="T_6adad_row1_col4" class="data row1 col4" >0.040337</td>
      <td id="T_6adad_row1_col5" class="data row1 col5" >-0.000641</td>
      <td id="T_6adad_row1_col6" class="data row1 col6" >-0.004361</td>
    </tr>
    <tr>
      <th id="T_6adad_level0_row2" class="row_heading level0 row2" rowspan="2">2</th>
      <th id="T_6adad_level1_row2" class="row_heading level1 row2" >ascent</th>
      <td id="T_6adad_row2_col0" class="data row2 col0" >0.000806</td>
      <td id="T_6adad_row2_col1" class="data row2 col1" >0.002395</td>
      <td id="T_6adad_row2_col2" class="data row2 col2" >-0.049256</td>
      <td id="T_6adad_row2_col3" class="data row2 col3" >-0.054787</td>
      <td id="T_6adad_row2_col4" class="data row2 col4" >0.119785</td>
      <td id="T_6adad_row2_col5" class="data row2 col5" >-0.021713</td>
      <td id="T_6adad_row2_col6" class="data row2 col6" >0.011238</td>
    </tr>
    <tr>
      <th id="T_6adad_level1_row3" class="row_heading level1 row3" >descent</th>
      <td id="T_6adad_row3_col0" class="data row3 col0" >-0.011092</td>
      <td id="T_6adad_row3_col1" class="data row3 col1" >0.023527</td>
      <td id="T_6adad_row3_col2" class="data row3 col2" >-0.021657</td>
      <td id="T_6adad_row3_col3" class="data row3 col3" >0.052348</td>
      <td id="T_6adad_row3_col4" class="data row3 col4" >-0.032597</td>
      <td id="T_6adad_row3_col5" class="data row3 col5" >-0.003948</td>
      <td id="T_6adad_row3_col6" class="data row3 col6" >0.009433</td>
    </tr>
    <tr>
      <th id="T_6adad_level0_row4" class="row_heading level0 row4" rowspan="2">3</th>
      <th id="T_6adad_level1_row4" class="row_heading level1 row4" >ascent</th>
      <td id="T_6adad_row4_col0" class="data row4 col0" >-0.007776</td>
      <td id="T_6adad_row4_col1" class="data row4 col1" >-0.051923</td>
      <td id="T_6adad_row4_col2" class="data row4 col2" >0.024911</td>
      <td id="T_6adad_row4_col3" class="data row4 col3" >-0.010020</td>
      <td id="T_6adad_row4_col4" class="data row4 col4" >-0.039476</td>
      <td id="T_6adad_row4_col5" class="data row4 col5" >0.012501</td>
      <td id="T_6adad_row4_col6" class="data row4 col6" >-0.016588</td>
    </tr>
    <tr>
      <th id="T_6adad_level1_row5" class="row_heading level1 row5" >descent</th>
      <td id="T_6adad_row5_col0" class="data row5 col0" >0.007483</td>
      <td id="T_6adad_row5_col1" class="data row5 col1" >0.002109</td>
      <td id="T_6adad_row5_col2" class="data row5 col2" >0.025621</td>
      <td id="T_6adad_row5_col3" class="data row5 col3" >-0.001901</td>
      <td id="T_6adad_row5_col4" class="data row5 col4" >-0.048794</td>
      <td id="T_6adad_row5_col5" class="data row5 col5" >0.018292</td>
      <td id="T_6adad_row5_col6" class="data row5 col6" >-0.005158</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">weekly_wave_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span>
    <span class="p">:,</span>
    <span class="p">[</span>
        <span class="s2">&quot;count&quot;</span><span class="p">,</span>
        <span class="s2">&quot;condition__obesity&quot;</span><span class="p">,</span>
        <span class="s2">&quot;condition__blood_pressure&quot;</span><span class="p">,</span>
        <span class="s2">&quot;people_fully_vaccinated&quot;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">]</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">max</span><span class="p">())</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;pdate&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/intro_10_0.png" src="../../_images/intro_10_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">condition_counts</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;raw_conditions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
    <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">condition_counts</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>magasvérnyomás-betegség             20589
cukorbetegség                       12811
magas vérnyomás                      8891
iszkémiás szívbetegség               4860
szívbetegség                         3614
demencia                             3022
daganatos megbetegedés               2798
krónikus veseelégtelenség            2299
szívelégtelenség                     2224
veseelégtelenség                     1952
nem ismert alapbetegség              1950
szívritmuszavar                      1890
tüdőbetegség                         1874
érelmeszesedés                       1478
pitvarfibrilláció                    1438
vérszegénység                        1407
kóros elhízás                        1392
krónikus obstruktív tüdőbetegség     1379
elhízás                              1124
asztma                               1109
dtype: int64
</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./datasets/covid_victims"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../../dataset-pages/covid_victims.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Covid Victims</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../../dataset-pages/scimago_journals.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Scimago Journals</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By DataZimmer<br/>
    
        &copy; Copyright 2022.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>